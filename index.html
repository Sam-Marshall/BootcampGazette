<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Jobport Mockup</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.js"></script>
</head>

<body>
    <div class="container">
        <div class="row text-center">
            <div class=jumbotron>
                <h1>What's your dream job?</h1>
                <label for="job">Job</label>
                <input type="text" name="jobtitle" id="job-input" placeholder="ex: Mechanical Engineer">
                <br>
                <label for="city">City</label>
                <input type="text" name="cityName" id="city-input" placeholder="ex: Chicago">
                <br>
                <label for="state">State</label>
                <input type="text" name="stateName" id="state-input" placeholder="ex: IL">
                <br>
                <br>
                <button class="btn btn-info" id="submit-btn">Submit</button>
            </div>
            <div class="row">
                <div id="map" class="center-block"></div>
            </div>
            <div class="row">
                <div id="textHere"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    $(document).ready(function() {
        //lat lng storage
        var locationArray = [];
        //job url storage for click event to be fixed later
        var jobUrlArray = [];

        function myMap() {
            var mapProp = {
                center: new google.maps.LatLng(39.833333, -98.585522),
                zoom: 4,
            };

            var map = new google.maps.Map(document.getElementById('map'), mapProp);

            //looping through array to add markers for each locale
            for (var i = 0; i < locationArray.length; i++) {

                var myLatLng = {
                    lat: locationArray[i].lat,
                    lng: locationArray[i].lng
                };

                var marker;

                // marker.attr('data-state', 1);
                // marker.addClass('businessMarker');

                marker = new google.maps.Marker({
                    position: myLatLng,
                    map: map,
                    title: 'Hello World'

                }); //marker object

                marker.setMap(map);
                var contentString = "Hi!";
                var infoWindow = new google.maps.InfoWindow({
                    content: contentString
                });
                marker.addListener('click', function() {
                    infoWindow.open(map, marker);
                    // alert("Boop!");
                    // map.setZoom(8); //random map-centered zoom
                    // $('#textHere').append("Click!");
                }); //Listener
            } //for loop

            // Create an array of alphabetical characters used to label the markers.
            // var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

            // // Add some markers to the map.
            // // // Note: The code uses the JavaScript Array.prototype.map() method to
            // // // create an array of markers based on a given "locations" array.
            // // // The map() method here has nothing to do with the Google Maps API.
            // console.log(locationArray);
            // var markers = locationArray.map(function(location, i) {
            //   return new google.maps.Marker({
            //     position: location,
            //     label: labels[i % labels.length]
            //   });
            // });

            // // Add a marker clusterer to manage the markers.
            // var markerCluster = new MarkerClusterer(map, markers,
            //     {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
        }

        $("#submit-btn").on("click", function(event) {
            //empty array for new search
            locationArray = [];

            $('#textHere').html("");

            event.preventDefault();

            // marker.setMap(null);

            var job = $("#job-input").val().trim();
            var jobCity = $("#city-input").val().trim();
            var jobState = $("#state-input").val().trim();

            // $('#job-input').empty();

            var queryURL = "http://service.dice.com/api/rest/jobsearch/v1/simple.json?text=" + job + "&city=" + jobCity + ",+" + jobState;
            console.log(queryURL);
            $.ajax({
                url: queryURL,
                method: "GET"
            }).done(function(response) {

                console.log(response);

                var results = response.resultItemList;

                console.log(results);

                for (i = 0; i < results.length; i++) {
                    //trying to capture job links. Work in progress
                    jobUrlArray.push(results[i].detailUrl);

                    // console.log(jobUrlArray);
                    var city = results[i].location;
                    // console.log(city);

                    var queryURLcity = "https://maps.googleapis.com/maps/api/geocode/json?address=" + city + "&key=AIzaSyB_GC-33tMoeP_2GlBptjFH0ZIcER8Ztqg";

                    $.ajax({
                        url: queryURLcity,
                        method: "GET"
                    }).done(function(responsecity) {
                        console.log(locationArray);
                        // console.log(responsecity);
                        // console.log(responsecity.results[0].geometry.location);
                        locationArray.push(responsecity.results[0].geometry.location);
                        // console.log(locationArray);
                    }); //done function

                } //for loop

            }); //done function
            setTimeout(myMap, 3000);

        }); //submit button

        // });

        // console.log(locationArray);

    });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_GC-33tMoeP_2GlBptjFH0ZIcER8Ztqg&callback=myMap"></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
    </script>
</body>

</html>
